<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="report_product_vehicle_label" model="ir.actions.report">
        <field name="name">Etiqueta Veh√≠culo (55x30)</field>
        <field name="model">product.product</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">stock_delivery_box_grouping_module.report_product_label_vehicle_template</field>
        <field name="report_file">stock_delivery_box_grouping_module.report_product_label_vehicle_template</field>
        <field name="paperformat_id" ref="stock_delivery_box_grouping_module.paperformat_product_label_vehicle"/>
    </record>

    <template id="report_product_label_vehicle_template">
        <t t-call="web.basic_layout">
            <!-- RESET AGRESIVO -->
            <style>
                html, body { margin: 0 !important; padding: 0 !important; width: 100%; height: 100%; }
                .page { margin: 0 !important; padding: 0 !important; border: 0 !important; }
            </style>

            <div class="page">
                <!-- Bucle sobre IDs de movimientos -->
                <t t-foreach="move_ids_list" t-as="m_id">
                    
                    <t t-set="move" t-value="request.env['stock.move'].sudo().browse(int(m_id))"/>
                    <t t-set="product" t-value="move.product_id"/>
                    <t t-set="line_qty" t-value="int(move.product_uom_qty)"/>

                    <t t-foreach="range(line_qty)" t-as="i">
                        
                        <!-- 
                           CONTENEDOR 55x30
                           - Height: 28mm (2mm menos que el papel).
                           - Overflow: hidden.
                           - Page-break-after: always. 

                        -->
                        <div style="width: 55mm; height: 28mm; page-break-after: always; position: relative; overflow: hidden; background-color: white; color: black; margin: 0; padding: 0;">
                            <!-- Contenido interno con padding 1mm -->
                            <div style="padding: 1mm; width: 100%; height: 100%; box-sizing: border-box;">
                                
                                <table style="width: 100%; border-collapse: collapse;">
                                    
                                    <!-- 1. CABECERA (5mm) -->
                                    <tr style="height: 5mm;">
                                        <td style="width: 60%; vertical-align: middle; line-height: 1;">
                                            <span style="font-family: Arial, sans-serif; font-size: 8px; font-weight: 900;">CAPEMI</span>
                                        </td>
                                        <td style="width: 25%; vertical-align: middle; text-align: center; line-height: 1;">
                                            <span style="font-family: Arial, sans-serif; font-size: 8px; font-weight: 900;">IND. ARG.</span>
                                        </td>
                                    </tr>

                                    <!-- 2. CUERPO (13mm) -->
                                    <tr style="height: 13mm;">
                                        <td colspan="2" style="vertical-align: top; padding-top: 1mm;">
                                            <!-- Referencia -->
                                            <div style="font-family: Arial, sans-serif; font-size: 14px; font-weight: 900; line-height: 1; color: #000; margin-bottom: 1px;">
                                                <span t-field="product.default_code"/>
                                            </div>
                                            <!-- Nombre -->
                                            <div style="font-family: Arial, sans-serif; font-size: 8px; font-weight: 900; text-transform: uppercase; line-height: 1; max-height: 7mm; overflow: hidden;">
                                                <span t-field="product.name"/>
                                            </div>
                                        </td>
                                    </tr>

                                    <!-- 3. PIE (BARCODE) (10mm) -->
                                    <tr>
                                        <td colspan="2" style="text-align: left; vertical-align: bottom;">
                                            <t t-if="product.barcode">
                                                <!-- Barcode ancho 53mm -->
                                                <div style="width: 100%; display: flex; justify-content: flex-start;">
                                                    <div t-out="product.barcode" t-options="{'widget': 'barcode', 'symbology': 'auto', 'width': 400, 'height': 50, 'img_style': 'width:49mm; height:7mm;', 'quiet': 0, 'humanreadable': 0}"/>
                                                </div>
                                                <div style="font-family: monospace; font-size: 7px; letter-spacing: 1px; font-weight: bold; line-height: 1; text-align: left;">
                                                    <span t-field="product.barcode"/>
                                                </div>
                                            </t>
                                        </td>
                                    </tr>

                                </table>
                            </div>
                        </div>
                    </t>
                </t>
            </div>
        </t>
    </template>
</odoo>